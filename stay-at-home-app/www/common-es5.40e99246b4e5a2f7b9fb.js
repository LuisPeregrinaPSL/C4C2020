function asyncGeneratorStep(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){asyncGeneratorStep(o,r,i,a,s,"next",e)}function s(e){asyncGeneratorStep(o,r,i,a,s,"throw",e)}a(void 0)}))}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"/fki":function(e,t,n){"use strict";var r=n("mrSG"),i=n("8Y7J"),o=n("vCEr"),a=n("JJg2"),s=n("PkfG"),u=n("mlpq"),c=n("gcOT"),l=n("HC5s"),f=n("2qmX"),h=n("IzT6"),d=n("n6ga"),v=function e(t,n,r){_classCallCheck(this,e),this.coords=t,this.time=n,this.treeDiff=r||0},m=n("sZkV");n.d(t,"a",(function(){return g}));var p,g=((p=function(){function e(t,n,o,u,c){var h=this;_classCallCheck(this,e),this.gpsSvc=t,this.appStorageSvc=n,this.alertCtrl=o,this.audio=u,this.restApi=c,this.timeToGrowANewTree=a.a.TIME_TO_GROW_TREE,this.status=s.a.GROWING,this.grow=new i.m,this.shrink=new i.m,this.level=new i.m,t.beacon.subscribe((function(e){return r.a(h,void 0,void 0,regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.appStorageSvc.getConfiguration().then((function(t){if(l.a.convertToMeters(t.home.latitude,t.home.longitude,e.latitude,e.longitude)>a.a.DISTANCE_TO_HOUSE_THRESHOLD)n.status=s.a.SHRINKING,f.a.earliestGrowingDate=null,n.deductTree(),n.appStorageSvc.addHistory(new v(e,new Date,-1)),n.restApi.postLocation(e),n.shrink.emit(t.trees);else{var r=new Date;f.a.earliestGrowingDate?(n.status=s.a.GROWING,n.calculate(r,e)):f.a.earliestGrowingDate=r}}));case 1:case"end":return t.stop()}}),t,this)})))})),["new-tree","first-start","lose-tree","new-level"].forEach((function(e){return u.preloadSimple(e,"../public/assets/sounds/"+e+".mp3").then((function(e){console.log("Preloaded audio.")}),(function(e){console.error("Couldn't preload audio.")}))}))}return _createClass(e,[{key:"calculate",value:function(e,t){return r.a(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,i,o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!((r=f.a.calculateNewTrees(e))>0)){n.next=12;break}return n.next=4,this.appStorageSvc.getConfiguration();case 4:if(!(i=n.sent).geolocationEnabled||!i.home){n.next=11;break}return i.trees+=r,this.audio.play("new-tree"),this.grow.emit(r),(o=f.a.getPlayerLevel(i))>i.level&&(i.level=o,this.notifyUser("Congratulations","You have increased your forest level to "+o+"!"),this.level.emit(o)),n.next=11,this.appStorageSvc.setConfiguration(i);case 11:t&&this.appStorageSvc.addHistory(new v(t,new Date,r));case 12:return n.abrupt("return",r);case 13:case"end":return n.stop()}}),n,this)})))}},{key:"deductTree",value:function(){var e=this;this.appStorageSvc.getConfiguration().then((function(t){t.trees>0&&(t.trees--,e.appStorageSvc.setConfiguration(t),e.notifyUser("Return home!","You have one tree less now."))}))}},{key:"notifyUser",value:function(e,t){f.a.isInForeground()?this.showAlert(e,t):this.showLocalNotification(e,t)}},{key:"showLocalNotification",value:function(e,t){c.a.schedule({notifications:[{title:e,body:t,id:2,sound:null,attachments:null,actionTypeId:"",extra:null}]})}},{key:"showToast",value:function(e,t){return r.a(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,c.c.show({text:e+": "+t});case 2:case"end":return n.stop()}}),n)})))}},{key:"showAlert",value:function(e,t){return r.a(this,void 0,void 0,regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:f.a.isActive=!1,this.alertCtrl.create({header:e,message:t,buttons:["OK"]}).then((function(e){e.present().then((function(t){e.onDidDismiss().then((function(e){console.log("Dismissed, user is active again."),f.a.isActive=!0}))}))}));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"getCount",value:function(){return r.a(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.appStorageSvc.getConfiguration();case 2:return e.abrupt("return",e.sent.trees);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getCurrentLevel",value:function(){return r.a(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.appStorageSvc.getConfiguration();case 2:return t=e.sent,e.abrupt("return",f.a.getPlayerLevel(t));case 4:case"end":return e.stop()}}),e,this)})))}}]),e}()).ngInjectableDef=i.Nb({factory:function(){return new p(i.Ob(o.a),i.Ob(u.a),i.Ob(m.a),i.Ob(h.a),i.Ob(d.a))},token:p,providedIn:"root"}),p)},"3pPM":function(e,t,n){"use strict";var r=function(e){return e[e.xMin=-20]="xMin",e[e.xMax=20]="xMax",e[e.yMin=.31]="yMin",e[e.yMax=.31]="yMax",e[e.zMin=-2]="zMin",e[e.zMax=-15.5]="zMax",e}({}),i=[];i.common={name:"Common",label:"Common",gltfModel:"tree2",id:"treeCommon",src:"/assets/gltf/tree4.glb",posY:0,minY:0,scaleX:1,scaleY:1,scaleZ:-1},i.pine={name:"Pine",label:"Pine",gltfModel:"pine",id:"treePine",src:"/assets/gltf/pine.glb",posY:.31,minY:0,scaleX:2,scaleY:2,scaleZ:-2},i.palm={name:"Palm",label:"Palm",gltfModel:"palm",id:"treePalm",src:"/assets/gltf/palm.glb",posY:.31,minY:0,scaleX:.25,scaleY:.5,scaleZ:-.25},i.bubinga={name:"Bubinga",label:"Bubinga",gltfModel:"bubinga",id:"treeBubinga",src:"/assets/gltf/bubinga.glb",posY:.31,minY:0,scaleX:1,scaleY:1,scaleZ:-1},i.forest={name:"Forest",label:"Forest",gltfModel:"forest",id:"treeForest",src:"/assets/gltf/forest.glb",posY:.31,minY:0,scaleX:3.15,scaleY:3.27,scaleZ:-2.66};var o=[];function a(e){return console.log("getTreeModelByLevel"),console.log(o.length),e<0&&(e=0),null==o[e]&&(e=o.length-1),i[o[e]]}o[0]="common",o[1]="pine",o[2]="palm",o[3]="bubinga";var s=n("2qmX"),u=n("HC5s");n.d(t,"a",(function(){return c}));var c=function(){function e(t,n,r){_classCallCheck(this,e),this.treeCount=0,this.treeLimit=40,this.backCount=0,this.frontCount=0,this.level=1,this.__document=t,this.__aframe=n,this.__three=r,this.scene=this.__document.querySelector("a-scene"),console.log(this.scene),this.txt=this.scene.querySelector("#treeNumber"),this.env=this.scene.querySelector("#env"),this.infoBlock=this.__document.querySelector("#info_block"),this.countInfo=this.infoBlock.querySelector("#tree_count"),this.setEvents(),this.setLevel(0)}return _createClass(e,[{key:"setEvents",value:function(){this.__aframe.registerComponent("show-three-info",{schema:{},init:function(){var e=this.data,t=this.el,n=t.parentNode.parentNode.querySelector("#info_block").querySelector("#content");t.addEventListener("mouseenter",(function(){n.innerHTML=e.text})),t.addEventListener("mouseleave",(function(){n.innerHTML="<br>"})),t.addEventListener("click",(function(e){n.innerHTML="You click on a tree!!!"}))}})}},{key:"setInitialAmount",value:function(){return console.log("treeCount: ",this.treeCount),this.backCount=Math.floor(this.treeCount/this.treeLimit)*this.treeLimit,console.log("backCount: ",this.backCount),this.env.setAttribute("environment","dressingAmount:"+this.backCount),this.treeCount-this.backCount}},{key:"showInformationPane",value:function(){this.infoBlock.style.visibility="visible"}},{key:"setCurrentView",value:function(e){var t,n;switch(console.log("Changing view",e),e){case"gView":case"aView":case"eView":t=this.scene.querySelector("#"+e);break;default:return}null!=this.currentView&&(this.currentView.setAttribute("active","false"),"eView"==this.currentView.getAttribute("id")&&(n=this.currentView.querySelector("#cursor"),this.currentView.removeChild(n))),t.setAttribute("active","true"),"eView"==e&&((n=this.__document.createElement("a-cursor")).setAttribute("id","cursor"),t.appendChild(n)),this.currentView=t}},{key:"setLevel",value:function(e){console.log("Setting level to ",e),this.level=e,0==this.frontCount?(this.frontCount=s.a.getTreesByLevel(this.level),console.log("Setting frontCount to",this.frontCount)):(this.resetLandscape(),this.convertLastLevelIntoForest()),this.level>0&&this.convertLastLevelIntoForest(),this.model=a(this.level)}},{key:"setLastLevel",value:function(e,t){console.log("Setting last level to",e),this.level=e,0==this.frontCount&&(this.frontCount=s.a.getTreesByLevel(this.level),console.log("Setting frontCount to",this.frontCount)),this.model=a(this.level),this.resetLandscape(),this.setTreeCount(t,!1)}},{key:"setTreeCount",value:function(e,t){console.log("Seeting tree count",e);var n=this.treeCount;console.log("Previous count",n),this.treeCount=e;var r=this.treeCount-n;console.log("first diff: ",r),this.treeCount>0&&0==n&&(r=this.setInitialAmount(),console.log("setInitialAmount: ",r)),console.log("diff: ",r),r>0&&(this.treeCount-this.backCount>this.treeLimit&&(this.resetLandscape(),r=this.treeCount-this.backCount,console.log("new diff",r)),this.addNewTrees(r,t),this.countInfo.innerHTML="You have "+this.treeCount+" trees")}},{key:"addNewTrees",value:function(e,t){if(console.log("Adding "+e+" new trees..."),this.frontCount+=e,e>0)for(var n=0;n<e;n++)this.addTree(t)}},{key:"addTree",value:function(e){console.log("Adding new tree...");var t=u.a.getRandomFloat(r.xMin,r.xMax),n=this.model.posY,i=u.a.getRandomFloat(r.zMin,r.zMax),o=this.__document.createElement("a-entity");o.setAttribute("id",this.model.id),o.setAttribute("position",t+" "+n+" "+i),e?(o.setAttribute("scale",this.model.scaleX+" "+this.model.minY+" "+this.model.scaleZ),o.setAttribute("animation","property: object3D.scale.y; to: "+this.model.scaleY+"; dir: alternate; dur: 2000; loop: false")):o.setAttribute("scale",this.model.scaleX+" "+this.model.scaleY+" "+this.model.scaleZ),o.setAttribute("rotation","0 0 0"),o.setAttribute("gltf-model","#"+this.model.gltfModel),o.setAttribute("animation-mixer",""),o.setAttribute("show-three-info","text: I am a "+this.model.name);var a=this.__document.createElement("a-animation");a.setAttribute("begin","click"),a.setAttribute("attribute","rotation"),a.setAttribute("to","0 360 0"),a.setAttribute("easing","linear"),a.setAttribute("dur","2000"),a.setAttribute("fill","backwards"),this.scene.appendChild(o)}},{key:"resetLandscape",value:function(){if(console.log("frontCount",this.frontCount),this.frontCount>0){var e;for(this.backCount+=this.frontCount,this.countInfo.innerHTML="You have reached the count limit, reseting landscape....";e=this.scene.querySelector("a-entity#"+this.model.id);)console.log("removing..."),console.log(e),this.scene.removeChild(e);this.frontCount=0,this.env.setAttribute("environment","dressingAmount:"+this.backCount)}}},{key:"convertLastLevelIntoForest",value:function(){var e=i.forest,t=this.level/1.3,n=-27.074*t,r=e.posY,o=-51.216*t,a=this.__document.createElement("a-entity");a.setAttribute("id",e.id),a.setAttribute("position",n+" "+r+" "+o),a.setAttribute("scale",e.scaleX*t+" "+e.minY+" "+e.scaleZ*t),a.setAttribute("animation","property: object3D.scale.y; to: "+e.scaleY*t+"; dir: alternate; dur: 2000; loop: false"),a.setAttribute("rotation","0 0 0"),a.setAttribute("gltf-model","#"+e.gltfModel),a.setAttribute("animation-mixer",""),a.setAttribute("show-three-info","text: I am a "+e.name),this.scene.appendChild(a)}}]),e}()},"6i10":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={bubbles:{dur:1e3,circles:9,fn:function(e,t,n){var r="".concat(e*t/n-e,"ms"),i=2*Math.PI*t/n;return{r:5,style:{top:"".concat(9*Math.sin(i),"px"),left:"".concat(9*Math.cos(i),"px"),"animation-delay":r}}}},circles:{dur:1e3,circles:8,fn:function(e,t,n){var r=t/n,i="".concat(e*r-e,"ms"),o=2*Math.PI*r;return{r:5,style:{top:"".concat(9*Math.sin(o),"px"),left:"".concat(9*Math.cos(o),"px"),"animation-delay":i}}}},circular:{dur:1400,elmDuration:!0,circles:1,fn:function(){return{r:20,cx:48,cy:48,fill:"none",viewBox:"24 24 48 48",transform:"translate(0,0)",style:{}}}},crescent:{dur:750,circles:1,fn:function(){return{r:26,style:{}}}},dots:{dur:750,circles:3,fn:function(e,t){return{r:6,style:{left:"".concat(9-9*t,"px"),"animation-delay":-110*t+"ms"}}}},lines:{dur:1e3,lines:12,fn:function(e,t,n){return{y1:17,y2:29,style:{transform:"rotate(".concat(30*t+(t<6?180:-180),"deg)"),"animation-delay":"".concat(e*t/n-e,"ms")}}}},"lines-small":{dur:1e3,lines:12,fn:function(e,t,n){return{y1:12,y2:20,style:{transform:"rotate(".concat(30*t+(t<6?180:-180),"deg)"),"animation-delay":"".concat(e*t/n-e,"ms")}}}}}},HC5s:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getRandomInt",value:function(e,t){return t||(t=e,e=0),Math.floor(Math.random()*(t-e+1)+e)}},{key:"getRandomFloat",value:function(e,t){return t||(t=e,e=0),(Math.random()*(t-e)+e).toFixed(5)}},{key:"convertToMeters",value:function(e,t,n,r){var i=n*Math.PI/180-e*Math.PI/180,o=r*Math.PI/180-t*Math.PI/180,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6378.137*1e3}}]),e}()},KwJk:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return s}));var r=function(e,t){return null!==t.closest(e)},i=function(e){return"string"==typeof e&&e.length>0?_defineProperty({"ion-color":!0},"ion-color-".concat(e),!0):void 0},o=function(e){var t={};return function(e){return void 0!==e?(Array.isArray(e)?e:e.split(" ")).filter((function(e){return null!=e})).map((function(e){return e.trim()})).filter((function(e){return""!==e})):[]}(e).forEach((function(e){return t[e]=!0})),t},a=/^[a-z][a-z0-9+\-.]*:/,s=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t||"#"===t[0]||a.test(t)){e.next=4;break}if(!(i=document.querySelector("ion-router"))){e.next=4;break}return e.abrupt("return",(null!=n&&n.preventDefault(),i.push(t,r)));case 4:return e.abrupt("return",!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},NqGI:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));var r=function(){var e=_asyncToGenerator(regeneratorRuntime.mark((function e(t,n,r,i,o){var a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=2;break}return e.abrupt("return",t.attachViewToDom(n,r,o,i));case 2:if("string"==typeof r||r instanceof HTMLElement){e.next=4;break}throw new Error("framework delegate is missing");case 4:if(a="string"==typeof r?n.ownerDocument&&n.ownerDocument.createElement(r):r,i&&i.forEach((function(e){return a.classList.add(e)})),o&&Object.assign(a,o),n.appendChild(a),e.t0=a.componentOnReady,!e.t0){e.next=12;break}return e.next=12,a.componentOnReady();case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}(),i=function(e,t){if(t){if(e)return e.removeViewFromDom(t.parentElement,t);t.remove()}return Promise.resolve()}},PkfG:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){return e[e.GROWING=0]="GROWING",e[e.SHRINKING=1]="SHRINKING",e}({})},Uwmq:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){try{if("string"!=typeof e||""===e)return e;var t=document.createDocumentFragment(),n=document.createElement("div");t.appendChild(n),n.innerHTML=e,s.forEach((function(e){for(var n=t.querySelectorAll(e),r=n.length-1;r>=0;r--){var a=n[r];a.parentNode?a.parentNode.removeChild(a):t.removeChild(a);for(var s=o(a),u=0;u<s.length;u++)i(s[u])}}));for(var r=o(t),a=0;a<r.length;a++)i(r[a]);var u=document.createElement("div");u.appendChild(t);var c=u.querySelector("div");return null!==c?c.innerHTML:u.innerHTML}catch(l){return console.error(l),""}},i=function e(t){if(!t.nodeType||1===t.nodeType){for(var n=t.attributes.length-1;n>=0;n--){var r=t.attributes.item(n),i=r.name;if(a.includes(i.toLowerCase())){var s=r.value;null!=s&&s.toLowerCase().includes("javascript:")&&t.removeAttribute(i)}else t.removeAttribute(i)}for(var u=o(t),c=0;c<u.length;c++)e(u[c])}},o=function(e){return null!=e.children?e.children:e.childNodes},a=["class","id","href","src","name","slot"],s=["script","style","iframe","meta","link","object","embed"]},abcn:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function e(){_classCallCheck(this,e),this.level=0,this.geolocationEnabled=!1,this.deviceId="Default device id",this.trees=0,this.home=null}},fzvj:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return r}));var r=function(){var e=window.TapticEngine;e&&e.selection()},i=function(){var e=window.TapticEngine;e&&e.gestureSelectionStart()},o=function(){var e=window.TapticEngine;e&&e.gestureSelectionChanged()},a=function(){var e=window.TapticEngine;e&&e.gestureSelectionEnd()}},n6ga:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("l207"),i=n("8Y7J"),o=n("IheW"),a=function(){var e=function(){function e(t){_classCallCheck(this,e),this.http=t}return _createClass(e,[{key:"get",value:function(e){return this.http.get(r.a.SERVER+"/"+e)}},{key:"uploadImage",value:function(e,t){var n=this.formData("image",t);return this.http.post(r.a.SERVER+r.a.SERVER_IMAGE_URL+"?id="+e,n)}},{key:"postLocation",value:function(e){return this.http.post(r.a.ELASTIC_SERVER_POST_URL,e)}},{key:"blobFromDataURI",value:function(e){for(var t=atob(e.replace(/[^,]+,/,"")),n=[],r=0,i=t.length;r<i;r++)n.push(t.charCodeAt(r));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}},{key:"formData",value:function(e,t){var n=new FormData;return n.append(e,this.blobFromDataURI(t)),n}}]),e}();return e.ngInjectableDef=i.Nb({factory:function(){return new e(i.Ob(o.c))},token:e,providedIn:"root"}),e}()}}]);